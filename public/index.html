<!DOCTYPE html>
<html>
<head>
  <title>Encrypted Proxy Loader</title>
</head>
<body>
  <h1>Loadingâ€¦</h1>

  <script type="module">
    // Register SW
    const reg = await navigator.serviceWorker.register("/sw.js");
    await navigator.serviceWorker.ready;

    // Create SharedWorker
    const shared = new SharedWorker("/shared.js");

    // Send its port to SW
    const msg = new MessageChannel();

    reg.active.postMessage(
      { type: "connect-shared-worker" },
      [shared.port, msg.port2]
    );

    shared.port.start();
  </script>
</body>
</html>
