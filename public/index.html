<!DOCTYPE html>
<html>
<head>
  <title>Encrypted Proxy Loader</title>
</head>
<body>
  <h1>Loading…</h1>

  <script type="module">
  // Register the SW
  await navigator.serviceWorker.register("/sw.js");
  await navigator.serviceWorker.ready;

  // Create the SharedWorker
  const shared = new SharedWorker("/shared.js");
  shared.port.start();

  // Give its port to the SW
  navigator.serviceWorker.controller.postMessage(
    {
      type: "connect-shared-worker"
    },
    [shared.port]   // ← ONLY ONE PORT!
  );

  console.log("[Page] SharedWorker port sent to SW");
</script>
</body>
</html>
