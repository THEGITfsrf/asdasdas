<!DOCTYPE html>
<html>
<head>
  <title>Encrypted Proxy Loader</title>
</head>
<body>
  <h1>Loadingâ€¦</h1>

  <script type="module">
  await navigator.serviceWorker.register("/sw.js");

  if (!navigator.serviceWorker.controller) {
    location.reload();
  }

  // Create the SharedWorker
  const shared = new SharedWorker("/shared.js");
  shared.port.start();

  navigator.serviceWorker.controller.postMessage(
    { type: "connect-shared-worker" },
    [shared.port]
  );

  console.log("[Page] SharedWorker port sent to SW");
</script>

</body>
</html>
